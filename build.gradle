buildscript {
	repositories {
		mavenCentral()
		maven {
			name 'Forge'
			url 'https://maven.minecraftforge.net'
		}
		maven {
			url = 'https://repo.spongepowered.org/maven'
		}
	}
	dependencies {
		classpath('com.anatawa12.forge:ForgeGradle:2.3-+') {
			changing = true
		}
		classpath 'org.spongepowered:mixingradle:0.8.5'
	}
}

apply plugin: 'net.minecraftforge.gradle.forge'
apply plugin: 'org.spongepowered.mixin'

version = project.mod_version

minecraft {
	version = '1.12.2-14.23.5.2847'
	runDir = 'run'
	mappings = 'stable_39'

	def args = [
		'-Dfml.coreMods.load=io.redstudioragnarok.FBP.asm.FBPPlugin'
	]

	replace('@VERSION@', project.version)
	replaceIn('ModReference.java')
}

configurations {
	implementation
	compile.extendsFrom(embed)
}

repositories {
	maven {
		url 'https://maven.cleanroommc.com'
	}

	ivy {
		url 'https://github.com/'

		patternLayout {
			artifact '[organisation]/[module]/releases/download/v[revision]/[module]-[revision].[ext]'
		}

		metadataSources { artifact() } 
	}
}

dependencies {
	compile 'zone.rong:mixinbooter:7.0'
	implementation 'net.jafama:jafama:2.+'
	embed 'net.jafama:jafama:2.+'
	implementation 'meldexun:MatrixUtil:1.2.0@jar'
	embed 'meldexun:MatrixUtil:1.2.0@jar'
}

processResources {
	duplicatesStrategy = 'include'
	// this will ensure that this task is redone when the versions change.
	inputs.property 'version', project.version
	from(sourceSets.main.resources.srcDirs) {
		include 'mcmod.info'
		// replace version and mcversion
		expand 'version':project.version
	}
	// copy everything else except the mcmod.info
	from(sourceSets.main.resources.srcDirs) {
		exclude 'mcmod.info'
	}
}

sourceSets {
	main {
		ext.refMap = 'io.redstudioragnarok.FBP.asm.FBPPlugin'
	}
}

jar {
	from(configurations.embed.collect {
		it.isDirectory() ? it : zipTree(it)
	})
	manifest.attributes([
		'ModSide': 'CLIENT',
		'FMLAT': 'fbp_at.cfg',
		'FMLCorePlugin': 'io.redstudioragnarok.FBP.asm.FBPPlugin',
		'FMLCorePluginContainsFMLMod': 'true',
		'ForceLoadAsMod': 'true',
		'TweakClass': 'org.spongepowered.asm.launch.MixinTweaker',
		'TweakOrder': '0'
	])
}
